<!DOCTYPE html>
<html>
    <head>
        <!-- meta information -->
<meta charset="utf-8">
<meta name="description" 
      content="## ContexteLes tests sont importants pour s'assurer que l'application est toujours en état de fonctionner. C'est auss..." >
<meta name="author" content="L'équipe Evaneos.com">

<!-- Enable responsiveness on mobile devices-->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<!-- title -->
<title>Premiers pas dans les tests en javascript &middot; Blog technique Evaneos.com</title>

<!-- icons -->
<link rel="shortcut icon" href="/public/favicon.ico" />

<!-- stylesheets -->
<link rel="stylesheet" href="/public/css/main.css">
<link rel="stylesheet" href="/public/css/syntax.css">

<!-- Google fonts -->
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,900|Raleway:500,800' rel='stylesheet' type='text/css'>

<!-- feed links -->
<link rel="alternate" href="/feed.xml" type="application/rss+xml" title="">

    </head>
    <body>

    <div class="wrapper">
        <div class="sidebar">
            <div class="in">
                
                    <div class="site-title"><a href="/"><span>Les développeurs</span> Evaneos.com</a></div>
                
                <nav>
                    <ul>
  
    <li><a href="/" title="Le blog technique Evaneos.com"
     >Accueil</a>
    </li>
  
    <li><a href="/about" title="Pour en savoir plus"
     >A propos</a>
    </li>
  
</ul>

                </nav>
            </div>
            <p class="legal">Site sous licence <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/deed.en_US">CC BY-NC 4.0</a>.</p>
        </div>
        <div class="content-wrapper">
            
<article class="post">
  <header>
    <div class="metas">
      Le <time datetime="2014-04-22">22/04/2014</time>, par christophe
          
              <a href="http://twitter.com/churpeau">@churpeau</a>
          
      
    </div>
    <h1>Premiers pas dans les tests en javascript</h1>
  </header>

  <div class="content"><h2>Contexte</h2>

<p>Les tests sont importants pour s&#39;assurer que l&#39;application est toujours en état de fonctionner. C&#39;est aussi rassurant pour le développeur avant de faire sa mise en prod de vérifier que les fonctionnalités marchent encore. L&#39;objectif de ce billet et d&#39;avoir un apercu de quelques outils permettant de tester du javascript coté navigateur, jusqu&#39;au tests sur IE dans une machine virtuelle.</p>

<h2>Le fichier de test</h2>

<p>Il existe de nombreuses libraries pour faire des tests unitaires en javascript, à commencer par la <a href="http://nodejs.org/api/assert.html">librarie native de nodejs</a>. Mon choix s&#39;est d&#39;abord porté sur <a href="http://chaijs.com/">Chai</a>, style TDD assert, avant de me rendre compte qu&#39;il n&#39;était pas compatible avec les anciennes versions d&#39;IE et j&#39;ai donc exploré <a href="https://github.com/rowanmanning/proclaim">Proclaim</a>.</p>

<p>Installation :</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">npm install --save-dev proclaim
</code></pre></div>
<p>Voici donc ci-dessous un test tout simple :</p>

<p><code>tests/test.js</code></p>
<div class="highlight"><pre><code class="language-js" data-lang="js">var assert = proclaim;

test(&#39;basic DOM test&#39;, function() {
    var el = document.createElement(&quot;div&quot;);
    el.id = &quot;myDiv&quot;;
    el.innerHTML = &quot;Hello World!&quot;;
    document.body.appendChild(el);
    var myEl = document.getElementById(&#39;myDiv&#39;);
    assert.equal(myEl.innerHTML, &quot;Hello World!&quot;);
    document.body.removeChild(el);
    el = null;
    myEl = null;
});
</code></pre></div>
<h3>Mocha</h3>

<p>Ensuite, nous avons besoin d&#39;une librairie qui encapsule ces tests et les lancent. <a href="http://visionmedia.github.io/mocha/">Mocha</a> est l&#39;une des plus connues.</p>

<p>Installation :</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">npm install --save-dev mocha
</code></pre></div>
<p>On peut lancer nos tests avec un fichier html:</p>

<p><code>tests.html</code></p>
<div class="highlight"><pre><code class="language-html" data-lang="html">&lt;html&gt;
&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot;&gt;
    &lt;title&gt;Mocha Tests&lt;/title&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;node_modules/mocha/mocha.css&quot; /&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id=&quot;mocha&quot;&gt;&lt;/div&gt;
    &lt;script src=&quot;node_modules/mocha/mocha.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;node_modules/proclaim/lib/proclaim.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
        window.assert = proclaim;
        mocha.setup({ ui: &#39;tdd&#39; });
    &lt;/script&gt;
    &lt;script src=&quot;tests/test.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
        mocha.checkLeaks();
        mocha.run();
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre></div>
<h3>Karma</h3>

<p>Karma permet de lancer les tests simultanément dans plusieurs navigateurs. Il faut installer les plugins correspondant aux navigateurs, créer un fichier de configuration, et on a le résultat dans la console.</p>

<p>Installation :</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">sudo npm install -g karma-cli &amp;&amp; npm install --save-dev karma karma-mocha karma-proclaim karma-chrome-launcher karma-firefox-launcher
</code></pre></div>
<p><code>karam.conf.js</code></p>
<div class="highlight"><pre><code class="language-js" data-lang="js">module.exports = function(config) {
    config.set({

        // base path, that will be used to resolve files and exclude
        basePath: &#39;&#39;,

        frameworks: [&#39;mocha&#39;, &#39;proclaim&#39;],

        browsers: [
            &#39;Firefox&#39;,
            &#39;Chrome&#39;,
        ],

        files: [
            &#39;mocha.conf.js&#39;,
            &#39;tests/test.js&#39;,
        ],

        // test results reporter to use
        // possible values: &#39;dots&#39;, &#39;progress&#39;, &#39;junit&#39;, &#39;growl&#39;, &#39;coverage&#39;
        reporters: [&#39;progress&#39;],


        // enable / disable colors in the output (reporters and logs)
        colors: true,


        // level of logging
        // possible values: config.LOG_DISABLE || config.LOG_ERROR || config.LOG_WARN || config.LOG_INFO || config.LOG_DEBUG
        logLevel: config.LOG_INFO,


        // enable / disable watching file and executing tests whenever any file changes
        autoWatch: true,
    });
};
</code></pre></div>
<p><code>mocha.conf.js</code></p>
<div class="highlight"><pre><code class="language-js" data-lang="js">window.mocha.setup({ui: &#39;tdd&#39;});
window.mocha.checkLeaks();
</code></pre></div>
<p>Puis lancer avec <code>karma start</code>.</p>

<h2>Karma et IE</h2>

<p>Il est possible de lancer ces tests sur IE via une machine virtuelle. Pour ca, il faut d&#39;abord installer <a href="https://github.com/xdissent/ievms">ievms</a> qui se charge de créer des marchines virtuelles dans VirtualBox.</p>

<p>De retour sur le projet, il faut installer un nouveau plugin:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">npm install --save-dev karma-ievms
</code></pre></div>
<p>Puis rajouter dans la configuration de karma:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">//...

        browsers: [
            &#39;Firefox&#39;,
            &#39;Chrome&#39;,
            &#39;IE6 - WinXP&#39;,
            &#39;IE7 - WinXP&#39;,
            &#39;IE8 - WinXP&#39;,
            &#39;IE9 - Win7&#39;,
            &#39;IE10 - Win7&#39;,
            &#39;IE11 - Win7&#39;
        ]
</code></pre></div>
<p>A noter: Karma utilise socket.io, et sur les anciens navigateurs il vaut mieux avoir flash installé.</p>

<h2>Testling</h2>

<p>Pour terminer, on peut utiliser <a href="https://ci.testling.com/">Testling</a> pour mettre en place ces tests à chaque push dans github et avoir un badge indiquant les navigateurs testés.</p>

<p>Il suffit de <a href="https://ci.testling.com/guide/quick_start#configuring-the-web-hook">configurer le web hook</a> puis de modifier le fichier <code>package.json</code> :</p>
<div class="highlight"><pre><code class="language-json" data-lang="json">
  &quot;testling&quot;: {
    &quot;html&quot;: &quot;tests.html&quot;,
    &quot;files&quot;: &quot;test/*.js&quot;,
    &quot;browsers&quot;: [
      &quot;ie/6..latest&quot;,
      &quot;chrome/latest&quot;,
      &quot;chrome/canary&quot;,
      &quot;firefox/3..3.6&quot;,
      &quot;firefox/latest&quot;,
      &quot;firefox/nightly&quot;,
      &quot;safari/latest&quot;,
      &quot;opera/11.0..latest&quot;,
      &quot;iphone/6&quot;,
      &quot;ipad/6&quot;,
      &quot;android-browser/latest&quot;
    ]
  }
</code></pre></div></div>


  
  <div id="disqus_thread"></div>
  <script type="text/javascript">
      var disqus_shortname = 'tech-evaneos';
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  
</article>

        </div>
    </div>

    <!-- Google analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-49353565-1', 'evaneos.github.io');
      ga('send', 'pageview');

    </script>
  </body>
</html>
